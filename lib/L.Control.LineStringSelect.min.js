/*
 MIT
 @author Alexander Milevski <info@w8r.name>
 @preserve
*/
function x(){return function m(n,h,b){function f(g,v){if(!h[g]){if(!n[g]){var t="function"==typeof require&&require;if(!v&&t)return t(g,!0);if(p)return p(g,!0);t=Error("Cannot find module '"+g+"'");throw t.code="MODULE_NOT_FOUND",t;}t=h[g]={exports:{}};n[g][0].call(t.exports,function(a){var e=n[g][1][a];return f(e?e:a)},t,t.exports,m,n,h,b)}return h[g].exports}for(var p="function"==typeof require&&require,g=0;g<b.length;g++)f(b[g]);return f}({1:[function(m,n){(("undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{}).L||m("leaflet")).Control.LineStringSelect=n.exports=m("./src/select")},{"./src/select":6,leaflet:void 0}],2:[function(m,n){(function(){function h(d,c){if(!(this instanceof h))return new h(d,c);this.k=Math.max(4,d||9);this.w=Math.max(2,Math.ceil(.4*this.k));c&&this.W(c);this.clear()}function b(d,c){d.a=f(d,0,d.children.length,c)}function f(d,c,a,e){for(var k=[Infinity,Infinity,-Infinity,-Infinity],u;c<a;c++)u=d.children[c],p(k,d.b?
e(u):u.a);return k}function p(d,c){d[0]=Math.min(d[0],c[0]);d[1]=Math.min(d[1],c[1]);d[2]=Math.max(d[2],c[2]);d[3]=Math.max(d[3],c[3])}function g(d,c){return d.a[0]-c.a[0]}function m(d,c){return d.a[1]-c.a[1]}function v(d){return(d[2]-d[0])*(d[3]-d[1])}function t(d){return d[2]-d[0]+(d[3]-d[1])}function a(d,c){return d[0]<=c[0]&&d[1]<=c[1]&&c[2]<=d[2]&&c[3]<=d[3]}function e(d,c){return c[0]<=d[2]&&c[1]<=d[3]&&c[2]>=d[0]&&c[3]>=d[1]}function k(d,c,a,e,k){for(var u=[c,a],b;u.length;)a=u.pop(),c=u.pop(),
a-c<=e||(b=c+Math.ceil((a-c)/e/2)*e,q(d,c,a,b,k),u.push(c,b,b,a))}function q(d,c,a,e,k){for(var b,f,r,l,g;a>c;){600<a-c&&(b=a-c+1,f=e-c+1,r=Math.log(b),l=.5*Math.exp(2*r/3),g=.5*Math.sqrt(r*l*(b-l)/b)*(0>f-b/2?-1:1),r=Math.max(c,Math.floor(e-f*l/b+g)),f=Math.min(a,Math.floor(e+(b-f)*l/b+g)),q(d,r,f,e,k));b=d[e];f=c;l=a;w(d,c,e);for(0<k(d[a],b)&&w(d,c,a);f<l;){w(d,f,l);f++;for(l--;0>k(d[f],b);)f++;for(;0<k(d[l],b);)l--}0===k(d[c],b)?w(d,c,l):(l++,w(d,l,a));l<=e&&(c=l+1);e<=l&&(a=l-1)}}function w(d,
c,a){var e=d[c];d[c]=d[a];d[a]=e}h.prototype={all:function(){return this.p(this.data,[])},search:function(d){var c=this.data,b=[],k=this.d;if(!e(d,c.a))return b;for(var f=[],u,g,r,l;c;){u=0;for(g=c.children.length;u<g;u++)r=c.children[u],l=c.b?k(r):r.a,e(d,l)&&(c.b?b.push(r):a(d,l)?this.p(r,b):f.push(r));c=f.pop()}return b},load:function(d){if(!d||!d.length)return this;if(d.length<this.w){for(var c=0,a=d.length;c<a;c++)this.aa(d[c]);return this}d=this.r(d.slice(),0,d.length-1,0);this.data.children.length?
this.data.height===d.height?this.I(this.data,d):(this.data.height<d.height&&(c=this.data,this.data=d,d=c),this.v(d,this.data.height-d.height-1,!0)):this.data=d;return this},aa:function(d){d&&this.v(d,this.data.height-1);return this},clear:function(){this.data={children:[],height:1,a:[Infinity,Infinity,-Infinity,-Infinity],b:!0};return this},remove:function(d){if(!d)return this;for(var c=this.data,e=this.d(d),b=[],k=[],f,g,r,l;c||b.length;){c||(c=b.pop(),g=b[b.length-1],f=k.pop(),l=!0);if(c.b&&(r=
c.children.indexOf(d),-1!==r)){c.children.splice(r,1);b.push(c);this.T(b);break}l||c.b||!a(c.a,e)?g?(f++,c=g.children[f],l=!1):c=null:(b.push(c),k.push(f),f=0,g=c,c=c.children[0])}return this},d:function(d){return d},n:function(d,c){return d[0]-c[0]},o:function(d,c){return d[1]-c[1]},toJSON:function(){return this.data},p:function(d,c){for(var a=[];d;)d.b?c.push.apply(c,d.children):a.push.apply(a,d.children),d=a.pop();return c},r:function(d,c,a,e){var f=a-c+1,g=this.k,q;if(f<=g)return q={children:d.slice(c,
a+1),height:1,a:null,b:!0},b(q,this.d),q;e||(e=Math.ceil(Math.log(f)/Math.log(g)),g=Math.ceil(f/Math.pow(g,e-1)));q={children:[],height:e,a:null};var f=Math.ceil(f/g),g=f*Math.ceil(Math.sqrt(g)),r,l,p;for(k(d,c,a,g,this.n);c<=a;c+=g)for(l=Math.min(c+g-1,a),k(d,c,l,f,this.o),r=c;r<=l;r+=f)p=Math.min(r+f-1,l),q.children.push(this.r(d,r,p,e-1));b(q,this.d);return q},S:function(d,c,a,e){for(var b,f,k,g,l,q,p,h;;){e.push(c);if(c.b||e.length-1===a)break;p=h=Infinity;b=0;for(f=c.children.length;b<f;b++){k=
c.children[b];l=v(k.a);q=d;var m=k.a;q=(Math.max(m[2],q[2])-Math.min(m[0],q[0]))*(Math.max(m[3],q[3])-Math.min(m[1],q[1]))-l;q<h?(h=q,p=l<p?l:p,g=k):q===h&&l<p&&(p=l,g=k)}c=g}return c},v:function(d,c,a){var e=this.d;a=a?d.a:e(d);var e=[],b=this.S(a,this.data,c,e);b.children.push(d);for(p(b.a,a);0<=c;)if(e[c].children.length>this.k)this.$(e,c),c--;else break;this.N(a,e,c)},$:function(d,a){var e=d[a],k=e.children.length,f=this.w;this.Q(e,f,k);k={children:e.children.splice(this.R(e,f,k)),height:e.height};
e.b&&(k.b=!0);b(e,this.d);b(k,this.d);a?d[a-1].children.push(k):this.I(e,k)},I:function(d,a){this.data={children:[d,a],height:d.height+1};b(this.data,this.d)},R:function(d,a,e){var b,k,g,q,p,l,h;p=l=Infinity;for(b=a;b<=e-a;b++){k=f(d,0,b,this.d);g=f(d,b,e,this.d);var m=k,n=g;q=Math.max(m[0],n[0]);var w=Math.max(m[1],n[1]),t=Math.min(m[2],n[2]),m=Math.min(m[3],n[3]);q=Math.max(0,t-q)*Math.max(0,m-w);k=v(k)+v(g);q<p?(p=q,h=b,l=k<l?k:l):q===p&&k<l&&(l=k,h=b)}return h},Q:function(a,c,e){var b=a.b?this.n:
g,k=a.b?this.o:m,f=this.q(a,c,e,b);c=this.q(a,c,e,k);f<c&&a.children.sort(b)},q:function(a,c,e,b){a.children.sort(b);b=this.d;var k=f(a,0,c,b),g=f(a,e-c,e,b),q=t(k)+t(g),h,l;for(h=c;h<e-c;h++)l=a.children[h],p(k,a.b?b(l):l.a),q+=t(k);for(h=e-c-1;h>=c;h--)l=a.children[h],p(g,a.b?b(l):l.a),q+=t(g);return q},N:function(a,c,e){for(;0<=e;e--)p(c[e].a,a)},T:function(a){for(var c=a.length-1,e;0<=c;c--)0===a[c].children.length?0<c?(e=a[c-1].children,e.splice(e.indexOf(a[c]),1)):this.clear():b(a[c],this.d)},
W:function(a){var e=["return a"," - b",";"];this.n=new Function("a","b",e.join(a[0]));this.o=new Function("a","b",e.join(a[1]));this.d=new Function("a","return [a"+a.join(", a")+"];")}};"undefined"!==typeof n?n.exports=h:"undefined"!==typeof self?self.M=h:window.M=h})()},{}],3:[function(m,n){var h=m("./marker"),b=h.extend({options:{radiusRatio:1.2},onAdd:function(b){this.on("mouseover",this.F,this).on("mouseout",this.D,this);h.prototype.onAdd.call(this,b)},onRemove:function(b){this.off("mouseover",
this.F,this).off("mouseout",this.D,this);h.prototype.onRemove.call(this,b)},F:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},D:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});n.exports=b},{"./marker":5}],4:[function(m,n){function h(b,f){var h=b[0]-f[0],g=b[1]-f[1];return h*h+g*g}n.exports={ca:function(b,f,p){var g=p[0]-f[0],m=p[1]-f[1],n=g*g+m*m,n=n&&((b[0]-f[0])*g+(b[1]-f[1])*(p[1]-f[1]))/n;return h(b,0>=n?f:1<=n?p:[f[0]+n*g,f[1]+n*m])},closestPointOnSegment:function(b,
f,h){var g=h[0]-f[0],m=h[1]-f[1];b=((b[0]-f[0])*g+(b[1]-f[1])*m)/(g*g+m*m);return[f[0]+b*(h[0]-f[0]),f[1]+b*(h[1]-f[1])]},ba:function(b,f,h,g){h/=g;g=b[0];b=b[1];return[g+h*(f[0]-g),b+h*(f[1]-b)]},distance:function(b,f){return Math.sqrt(h(b,f))}}},{}],5:[function(m,n){(function(h){h=(h.L||m("leaflet")).CircleMarker.extend({show:function(){this._container.style.visibility="";return this},hide:function(){this._container.style.visibility="hidden";return this}});n.exports=h}).call(this,"undefined"!==
typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}],6:[function(m,n){(function(h){var b=h.L||m("leaflet"),f=m("./geometry"),p=m("./marker"),g=m("./endpoint"),A=m("./selection"),v=h.M||m("rbush"),t=b.Control.extend({includes:b.Mixin.Events,statics:{Selection:A,Endpoint:g,ControlMarker:p},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",
name:"leaflet-linestring-select",lineWeight:4,lineTolerance:b.Browser.touch?10:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:b.Browser.touch,position:"topright"},initialize:function(a){a=a||{};this.m=this.e=this.f=this._feature=this._movingMarker=this._endMarker=this._startMarker=null;b.Util.setOptions(this,a);b.Control.prototype.initialize.call(this,
this.options)},onAdd:function(){var a=this._container=b.DomUtil.create("div",this.options.fa);b.DomEvent.disableClickPropagation(a).disableScrollPropagation(a);return a},onRemove:function(){this.disable()},enable:function(a){this.f=a.layer;this._feature=a.feature||a.layer.toGeoJSON();this.U();this.O();this.f.on("click",this.A,this);this._map.on("moveend zoomend resize",this.j,this).on("mousemove touchmove",this.G,this).on(b.Draggable.START.join(" "),this.C,this).on("click contextmenu",this.B,this);
this.j();return this},disable:function(){this.reset();this._map.removeLayer(this._movingMarker);this._movingMarker=null;this.f.off("click",this.A,this);this._map.off("moveend zoomend resize",this.j,this).off("mousemove touchmove",this.G,this).off(b.Draggable.START.join(" "),this.C,this).off("click contextmenu",this.B,this);this.f=this._feature=null;return this},reset:function(){this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null);this._endMarker&&(this._map.removeLayer(this._endMarker),
this._endMarker=null);this.e&&(this._map.removeLayer(this.e),this.e=null);this._movingMarker.setLatLng(this.f.getLatLngs()[0]);this.options.useTouch||this._movingMarker.show();this.fire("reset");return this},getSelection:function(){return this.e?this.e.getLatLngs():null},toGeoJSON:function(){return this.e?this.e.toGeoJSON():null},selectMeters:function(a,e){this.reset();if(0>a||0>e)throw Error("Can't use negative meter values for distance selection");var b=this.H(a),f=this.H(e),b=this.g(b),f=this.g(f);
this.h(b,b.start,b.end);this.h(f,f.start,f.end);return this},movingMarkerFactory:function(a,e){return new p(a,e)},endpointFactory:function(a,e){return new g(a,e)},selectionFactory:function(a,e,b){return new A(a,e,b)},s:function(a,e){return this.options.distance?this.options.distance(a,e):(new b.LatLng(a[1],a[0])).distanceTo(new b.LatLng(e[1],e[0]))},u:function(a){if(this.options.getProjectedPoint)return this.options.getProjectedPoint.call(this,a);a=this._map.options.crs.latLngToPoint(new b.LatLng(a[1],
a[0]),this._map.getMaxZoom());return[a.x,a.y]},Z:function(a,e,k){var g=this.s(a,e);a=this.u(a);e=this.u(e);a=f.ba(a,e,k,g);return b.point(a)},H:function(a){for(var e=this._feature.geometry.coordinates,k=0,f=1,g=e.length;f<g;f++){var d=this.s(e[f-1],e[f]);if(k+d<=a)k+=d;else break}if(k===a||f===e.length)return a=e[f-1],new b.LatLng(a[1],a[0]);a=this.Z(e[f-1],e[f],a-k);return this._map.options.crs.pointToLatLng(a,this._map.getMaxZoom())},j:function(){var a=this._map.getCenter(),e=.5*this.options.lineWeight+
this.options.lineTolerance,e=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(a).add(new b.Point(e,e)));this.m=new b.LatLng(Math.abs(a.lat-e.lat),Math.abs(a.lng-e.lng))},U:function(){var a=b.latLng(this.f._latlngs[0]),e=this.options.movingMarkerStyle;e.radius=this.options.lineTolerance;e.className=this.options.movingMarkerClass;this._movingMarker=this.movingMarkerFactory(a,e).addTo(this._map);this._movingMarker.on("click",this.Y,this);this.options.useTouch&&this._movingMarker.hide()},Y:function(){this.h(this._movingMarker.getLatLng(),
this._movingMarker.start,this._movingMarker.end)},A:function(a){var e=this.g(a.latlng);e?this.h(b.latLng(e),e.start,e.end):this.h(a.latlng)},B:function(a){if(!this._endMarker){var e=this._map.latLngToLayerPoint(a.latlng),k=this._movingMarker.getLatLng();this.options.useTouch&&(a=this.g(a.latlng))&&(k=b.latLng(a),this._movingMarker.setLatLng(k));a=this._map.latLngToLayerPoint(k);f.distance([e.x,e.y],[a.x,a.y])<=2*this.options.lineTolerance&&(k=this.g(k),this.h(k,k.start,k.end))}},h:function(a,e,b){var f=
this.options.endpointStyle;this._startMarker?this._endMarker||(f.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(a,f,!0).addTo(this._map),this._endMarker.start=e,this._endMarker.end=b,this._movingMarker.hide(),this.fire("select:end",{latlng:a}),this.l()):(f.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(a,f,!1).addTo(this._map),this._startMarker.start=e,this._startMarker.end=b,this.fire("select:start",{latlng:a}))},V:function(a){var e=this.m.lng,
b=this.m.lat;return[[a.lat-b,a.lng-e],[a.lat+b,a.lng+e]]},C:function(a){var e=a.originalEvent.target||a.originalEvent.srcElement;if(this.options.useTouch){var k;this._startMarker&&(k=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),f.distance([a.containerPoint.x,a.containerPoint.y],[k.x,k.y])<=2*this.options.lineTolerance&&(e=this._startMarker._path));this._endMarker&&(k=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),f.distance([a.containerPoint.x,a.containerPoint.y],
[k.x,k.y])<=2*this.options.lineTolerance&&(e=this._endMarker._path))}this._startMarker&&this._startMarker._path===e?this.c=this._startMarker:this._endMarker&&this._endMarker._path===e&&(this.c=this._endMarker);this.c&&(b.DomEvent.stop(a),this.c.c=!0,b.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this.J,this))},J:function(a){this.c&&(h.clearTimeout(this.t),b.Draggable._disabled=!1,this._map.dragging.enable(),this.c=this.c.c=null,this.X(this.c,a.latlng))},X:function(){this.l()},
P:function(){if(this._startMarker.start>this._endMarker.start){var a=this._startMarker;this._startMarker=this._endMarker;this._endMarker=a}},l:function(){this.P();var a=this.f._latlngs.slice(this._startMarker.end,this._endMarker.start+1);a.unshift(this._startMarker.getLatLng());a.push(this._endMarker.getLatLng());this.e?(this.e._latlngs=a,this.e.da(this._startMarker.end,this._endMarker.start)):(this.e=this.selectionFactory(a,this.options.selectionStyle,this.f).addTo(this._map),this._startMarker.bringToFront(),
this._endMarker.bringToFront());this.fire("selection")},G:function(a){var e=this.g(a.latlng);this.c?(e&&(this.c.start=e.start,this.c.end=e.end,this.c.setLatLng(e)),this._startMarker&&this._endMarker&&this.l(),h.clearTimeout(this.t),this.t=h.setTimeout(this.J.bind(this,a),750)):e&&(this._movingMarker.setLatLng(e),this._movingMarker.start=e.start,this._movingMarker.end=e.end)},g:function(a,e){var b=this.V(a,e),b=this.i.search(this.K(b[0].reverse(),b[1].reverse()));if(0!==b.length){var g=this._feature.geometry.coordinates,
h=Number.MAX_VALUE,d=[a.lng,a.lat],c=b[0].start,m=b[0].end,p=g[c],n=g[m];if(1<b.length)for(var u=0,t=b.length;u<t;u++){var r=g[b[u].start],l=g[b[u].end],v=f.ca(d,r,l);v<h&&(h=v,p=r,n=l,c=b[u].start,m=b[u].end)}d=f.closestPointOnSegment(d,p,n);d=[d[1],d[0]];d.start=c;d.end=m;return d}return null},O:function(){var a=this._feature.geometry.coordinates,b=[];this.i?this.i.clear():this.i=v();for(var f=1,g=a.length;f<g;f++){var h=this.K(a[f-1],a[f]);h.start=f-1;h.end=f;b.push(h)}this.i.load(b)},K:function(a,
b){var f=a[0],g=b[0],h=a[1],d=b[1];f>g&&(g=a[0],f=b[0]);h>d&&(d=a[1],h=b[1]);return[f,h,g,d]}});n.exports=t}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./endpoint":3,"./geometry":4,"./marker":5,"./selection":7,leaflet:void 0,rbush:2}],7:[function(m,n){(function(h){var b=h.L||m("leaflet");h=b.Polyline.extend({initialize:function(f,h,g){this._source=g;b.Polyline.prototype.initialize.call(this,f,h)},da:function(b,h){this._originalPoints=
this._source._originalPoints.slice(b,h+1);this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0]));this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1]));this._updatePath()}});n.exports=h}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}]},{},[1])(1)}
if("object"==typeof exports&&"undefined"!=typeof module)module.exports=x();else if("function"==typeof define&&define.ea)define([],x);else{var y;"undefined"!=typeof window?y=window:"undefined"!=typeof global?y=global:"undefined"!=typeof self&&(y=self);var z=y,z=z.L||(z.L={}),z=z.Control||(z.Control={});z.LineStringSelect=x()}!0;
